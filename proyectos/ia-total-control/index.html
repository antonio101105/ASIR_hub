<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASIR_hub | IA Total Control</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <div class="background-glow"></div>

    <nav class="navbar">
        <div class="logo">
            <a href="../../index.html"
                style="text-decoration: none; color: inherit; display: flex; align-items: center; gap: 0.5rem;">
                <i class="fa-solid fa-network-wired"></i> ASIR_hub
            </a>
        </div>
    </nav>
    <!DOCTYPE html>
    <html lang="es">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ASIR_hub | IA Total Control</title>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="../../styles.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    </head>

    <body>
        <div class="background-glow"></div>

        <nav class="navbar">
            <div class="logo">
                <a href="../../index.html"
                    style="text-decoration: none; color: inherit; display: flex; align-items: center; gap: 0.5rem;">
                    <i class="fa-solid fa-network-wired"></i> ASIR_hub
                </a>
            </div>
        </nav>

        <main class="container" style="padding-top: 4rem;">
            <h1 style="font-size: 2.5rem; margin-bottom: 1rem;">IA Total Control</h1>
            <p style="color: var(--text-secondary); margin-bottom: 2rem;">Proyecto de control total mediante
                Inteligencia
                Artificial.</p>

            <div class="card" style="margin-bottom: 2rem;">
                <div class="card-header">
                    <h3><i class="fa-brands fa-python"></i> FileSystemAgent</h3>
                    <a href="filesystem_agent.py" download class="btn-primary"
                        style="text-decoration: none; font-size: 0.9rem;">
                        <i class="fa-solid fa-download"></i> Descargar Script
                    </a>
                </div>
                <p style="margin-bottom: 1rem;">Módulo central para la interacción con el sistema de archivos.</p>
                <pre
                    style="background: #0f172a; padding: 1rem; border-radius: 8px; overflow-x: auto; border: 1px solid var(--card-border); max-height: 500px;"><code style="color: #f8fafc; font-family: monospace;">import os
import sys
import subprocess
from pathlib import Path

class FileSystemAgent:
    def __init__(self, initial_path=None):
        """
        Initializes the agent with a starting directory.
        Defaults to the current working directory if none provided.
        """
        self.current_directory = Path(initial_path) if initial_path else Path.cwd()
        if not self.current_directory.exists():
             self.current_directory = Path.cwd()
        print(f"[System] Agent initialized at: {self.current_directory}")

    def change_directory(self, path):
        """
        Changes the current working directory.
        Supports relative and absolute paths.
        """
        try:
            # Handle '..' and other relative paths safely
            target = (self.current_directory / path).resolve()
            
            if target.exists() and target.is_dir():
                self.current_directory = target
                return f"Directory changed to: {self.current_directory}"
            else:
                return f"Error: Directory '{path}' not found."
        except Exception as e:
            return f"Error changing directory: {e}"

    def list_directory(self):
        """
        Lists the contents of the current directory.
        """
        try:
            items = os.listdir(self.current_directory)
            if not items:
                return "Directory is empty."
            
            # Format output for better readability
            output = []
            for item in items:
                item_path = self.current_directory / item
                type_str = "<DIR>" if item_path.is_dir() else "<FILE>"
                output.append(f"{type_str:<8} {item}")
            return "\n".join(output)
        except Exception as e:
            return f"Error listing directory: {e}"

    def read_file(self, path):
        """
        Reads and returns the content of a file.
        """
        try:
            target = (self.current_directory / path).resolve()
            if target.exists() and target.is_file():
                with open(target, 'r', encoding='utf-8') as f:
                    return f.read()
            else:
                return f"Error: File '{path}' not found."
        except Exception as e:
            return f"Error reading file: {e}"

    def write_file(self, path, content):
        """
        Writes content to a file. Overwrites if exists.
        """
        try:
            target = (self.current_directory / path).resolve()
            with open(target, 'w', encoding='utf-8') as f:
                f.write(content)
            return f"Successfully wrote to '{path}'."
        except Exception as e:
            return f"Error writing file: {e}"

    def execute_command(self, command):
        """
        Executes a system command in the current directory.
        Returns stdout + stderr.
        """
        try:
            result = subprocess.run(
                command,
                cwd=self.current_directory,
                shell=True,
                capture_output=True,
                text=True
            )
            output = result.stdout
            if result.stderr:
                output += f"\n[Stderr]:\n{result.stderr}"
            return output.strip()
        except Exception as e:
            return f"Error executing command: {e}"

if __name__ == "__main__":
    agent = FileSystemAgent()
    print("=== FileSystemAgent CLI ===")
    print("Commands: cd <path>, ls, read <file>, write <file> <content>, exec <cmd>, exit")
    
    while True:
        try:
            user_input = input(f"\n{agent.current_directory}> ").strip()
            if not user_input:
                continue
            
            if user_input.lower() in ['exit', 'quit']:
                print("Shutting down agent.")
                break
            
            parts = user_input.split(' ', 1)
            cmd = parts[0].lower()
            arg = parts[1] if len(parts) > 1 else ""

            if cmd == 'cd':
                print(agent.change_directory(arg))
            elif cmd == 'ls':
                print(agent.list_directory())
            elif cmd == 'read':
                print(agent.read_file(arg))
            elif cmd == 'write':
                if ' ' in arg:
                    filename, content = arg.split(' ', 1)
                    print(agent.write_file(filename, content))
                else:
                    print("Usage: write <filename> <content>")
            elif cmd == 'exec':
                print(agent.execute_command(arg))
            else:
                print(f"Unknown command: {cmd}")
                
        except KeyboardInterrupt:
            print("\nExiting...")
            break
        except Exception as e:
            print(f"Critical Error: {e}")</code></pre>
            </div>
        </main>

        <footer>
            <p>&copy; 2024 ASIR_hub. Hecho con <i class="fa-solid fa-heart"></i> para la comunidad.</p>
        </footer>
    </body>

    </html>